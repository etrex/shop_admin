import{_ as z,p as G,s as H,r as m,v as J,o as K,E as _,a as r,x as Q,b as g,d as W,h as y,e as l,w as a,u as X,y as Y,g as k,m as n,i as V}from"./index-ac2423d8.js";const Z={class:"task-list"},ee={class:"page-header"},te={class:"dialog-footer"},le={class:"dialog-footer"},ae={__name:"TaskListView",setup(oe){const D=G(),b=H(),c=m(!1),s=m(null),$=J(()=>b.getAllOrders.filter(o=>o.status==="pending")),v=m(!1),d=m({orderId:null,estimatedShipDate:null,note:""}),f=m(!1),u=m({orderId:null,reason:""}),L=o=>new Date(o).toLocaleString(),T=o=>o.toLocaleString(),M=o=>({online:"線上付款",cod:"貨到付款"})[o]||o,N=o=>o.products.some(e=>e.preorder),U=o=>{D.push({name:"order-detail",params:{id:o}})},h=o=>{d.value={orderId:o.id,estimatedShipDate:null,note:""},v.value=!0},j=async()=>{if(!d.value.estimatedShipDate){_.warning("請選擇預計出貨日");return}try{s.value=d.value.orderId,await b.updateOrderStatus(d.value.orderId,"processing",{estimatedShipDate:d.value.estimatedShipDate,note:d.value.note}),v.value=!1,_.success("訂單已確認")}finally{s.value=null}},B=o=>{u.value={orderId:o.id,reason:""},f.value=!0},E=async()=>{if(!u.value.reason){_.warning("請輸入拒絕原因");return}try{s.value=u.value.orderId,await b.updateOrderStatus(u.value.orderId,"cancelled",{reason:u.value.reason}),f.value=!1,_.success("訂單已拒絕")}finally{s.value=null}},F=o=>o.getTime()<Date.now()-864e5;return K(()=>{c.value=!0;try{c.value=!1}catch(o){console.error("獲取訂單列表失敗：",o),_.error("獲取訂單列表失敗"),c.value=!1}}),(o,e)=>{const i=r("el-button"),p=r("el-table-column"),C=r("el-tag"),P=r("el-button-group"),R=r("el-table"),q=r("el-date-picker"),w=r("el-form-item"),S=r("el-input"),x=r("el-form"),I=r("el-dialog"),A=Q("loading");return g(),W("div",Z,[y("div",ee,[e[9]||(e[9]=y("h2",null,"任務列表",-1)),l(i,{type:"primary",onClick:e[0]||(e[0]=t=>X(D).push({name:"order-create"}))},{default:a(()=>e[8]||(e[8]=[n(" 確認新訂單 ")])),_:1})]),Y((g(),k(R,{data:$.value,style:{width:"100%"}},{default:a(()=>[l(p,{prop:"id",label:"訂單編號",width:"120"}),l(p,{prop:"created_at",label:"建立時間",width:"180"},{default:a(({row:t})=>[n(V(L(t.created_at)),1)]),_:1}),l(p,{prop:"customer.name",label:"客戶姓名",width:"120"}),l(p,{label:"預購商品",width:"100"},{default:a(({row:t})=>[N(t)?(g(),k(C,{key:0,type:"warning"},{default:a(()=>e[10]||(e[10]=[n("是")])),_:1})):(g(),k(C,{key:1,type:"success"},{default:a(()=>e[11]||(e[11]=[n("否")])),_:1}))]),_:1}),l(p,{prop:"total",label:"訂單金額",width:"120"},{default:a(({row:t})=>[n(" NT$ "+V(T(t.total)),1)]),_:1}),l(p,{prop:"payment.method",label:"付款方式",width:"120"},{default:a(({row:t})=>[n(V(M(t.payment.method)),1)]),_:1}),l(p,{label:"操作",width:"250"},{default:a(({row:t})=>[l(P,null,{default:a(()=>[l(i,{type:"success",loading:s.value===t.id,onClick:O=>h(t)},{default:a(()=>e[12]||(e[12]=[n(" 確認訂單 ")])),_:2},1032,["loading","onClick"]),l(i,{type:"danger",loading:s.value===t.id,onClick:O=>B(t)},{default:a(()=>e[13]||(e[13]=[n(" 拒絕訂單 ")])),_:2},1032,["loading","onClick"])]),_:2},1024),l(i,{type:"primary",link:"",onClick:O=>U(t.id),class:"ml-2"},{default:a(()=>e[14]||(e[14]=[n(" 查看詳情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,c.value]]),l(I,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=t=>v.value=t),title:"確認訂單",width:"500px"},{footer:a(()=>[y("span",te,[l(i,{onClick:e[3]||(e[3]=t=>v.value=!1)},{default:a(()=>e[15]||(e[15]=[n("取消")])),_:1}),l(i,{type:"primary",onClick:j,loading:s.value},{default:a(()=>e[16]||(e[16]=[n(" 確認 ")])),_:1},8,["loading"])])]),default:a(()=>[l(x,{model:d.value,"label-width":"100px"},{default:a(()=>[l(w,{label:"預計出貨日"},{default:a(()=>[l(q,{modelValue:d.value.estimatedShipDate,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.estimatedShipDate=t),type:"date",placeholder:"選擇日期","disabled-date":F,class:"w-100"},null,8,["modelValue"])]),_:1}),l(w,{label:"備註"},{default:a(()=>[l(S,{modelValue:d.value.note,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.note=t),type:"textarea",rows:"3",placeholder:"請輸入備註（選填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(I,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=t=>f.value=t),title:"拒絕訂單",width:"500px"},{footer:a(()=>[y("span",le,[l(i,{onClick:e[6]||(e[6]=t=>f.value=!1)},{default:a(()=>e[17]||(e[17]=[n("取消")])),_:1}),l(i,{type:"danger",onClick:E,loading:s.value},{default:a(()=>e[18]||(e[18]=[n(" 拒絕 ")])),_:1},8,["loading"])])]),default:a(()=>[l(x,{model:u.value,"label-width":"100px"},{default:a(()=>[l(w,{label:"拒絕原因",required:""},{default:a(()=>[l(S,{modelValue:u.value.reason,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.reason=t),type:"textarea",rows:"3",placeholder:"請輸入拒絕原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},de=z(ae,[["__scopeId","data-v-b1772cec"]]);export{de as default};
