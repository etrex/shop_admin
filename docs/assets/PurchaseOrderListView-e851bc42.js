import{_ as J,G as K,r as m,v as W,a as c,b as _,d as h,h as i,e as t,w as s,F as A,f as M,g as k,m as r,i as o,B as V}from"./index-ac2423d8.js";const X={class:"purchase-order-list"},Z={class:"main-content"},ee={class:"card-header"},te={class:"filters"},ae={class:"pagination"},le={class:"summary"},se={class:"summary-item"},ne={class:"value"},re={class:"summary-item"},oe={class:"amount"},de={key:0,class:"related-orders"},ue={__name:"PurchaseOrderListView",setup(ie){const T=K(),b=m(""),y=m(""),f=m([]),N=m(1),C=m(20),U=m(100),D=m(!1),u=m(null),B=[{text:"最近一週",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,l]}},{text:"最近一個月",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,l]}},{text:"最近三個月",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,l]}}],Q=m([{id:"S001",name:"法國酒商",phone:"02-2345-6789",paymentTerm:"月結30天"},{id:"S002",name:"義大利酒商",phone:"02-3456-7890",paymentTerm:"月結45天"},{id:"S003",name:"日本酒商",phone:"02-4567-8901",paymentTerm:"月結60天"}]),F=W(()=>{var e;let l=T.getAllPurchaseOrders;if(b.value&&(l=l.filter(p=>p.supplier.id===b.value)),y.value&&(l=l.filter(p=>p.status===y.value)),((e=f.value)==null?void 0:e.length)===2){const p=f.value[0],S=f.value[1];l=l.filter(O=>{const n=new Date(O.createdAt);return n>=p&&n<=S})}return l}),E=l=>{u.value=l,D.value=!0},G=l=>{T.updatePurchaseOrderStatus(l.id,"confirmed")},H=l=>{T.updatePurchaseOrderStatus(l.id,"received")},z=l=>({pending:"待確認",confirmed:"已確認",received:"已到貨",cancelled:"已取消"})[l]||l,L=l=>({pending:"warning",confirmed:"primary",received:"success",cancelled:"info"})[l]||"",I=l=>l.items.reduce((e,p)=>e+(p.purchaseQty||0),0),w=l=>{const e=new Date(l);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},g=l=>l.toLocaleString();return(l,e)=>{const p=c("el-option"),S=c("el-select"),O=c("el-date-picker"),n=c("el-table-column"),x=c("el-tag"),P=c("el-button"),$=c("el-table"),R=c("el-pagination"),Y=c("el-card"),v=c("el-descriptions-item"),j=c("el-descriptions"),q=c("el-dialog");return _(),h("div",X,[e[12]||(e[12]=i("div",{class:"page-header"},[i("h2",null,"進貨單列表")],-1)),i("div",Z,[t(Y,{class:"full-width"},{header:s(()=>[i("div",ee,[i("div",te,[t(S,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),placeholder:"供應商",clearable:""},{default:s(()=>[(_(!0),h(A,null,M(Q.value,a=>(_(),k(p,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(S,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),placeholder:"狀態",clearable:""},{default:s(()=>[t(p,{label:"待確認",value:"pending"}),t(p,{label:"已確認",value:"confirmed"}),t(p,{label:"已到貨",value:"received"}),t(p,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),t(O,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),type:"daterange","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期",shortcuts:B},null,8,["modelValue"])])])]),default:s(()=>[t($,{data:F.value,style:{width:"100%"}},{default:s(()=>[t(n,{prop:"id",label:"進貨單號",width:"120"}),t(n,{prop:"createdAt",label:"建立時間",width:"160"},{default:s(({row:a})=>[r(o(w(a.createdAt)),1)]),_:1}),t(n,{prop:"supplier.name",label:"供應商",width:"120"}),t(n,{prop:"status",label:"狀態",width:"100"},{default:s(({row:a})=>[t(x,{type:L(a.status)},{default:s(()=>[r(o(z(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(n,{label:"商品"},{default:s(({row:a})=>[(_(!0),h(A,null,M(a.items,d=>(_(),k(x,{key:d.id,size:"small",class:"product-tag"},{default:s(()=>[r(o(d.name)+" x "+o(d.purchaseQty),1)]),_:2},1024))),128))]),_:1}),t(n,{prop:"totalAmount",label:"總金額",width:"120"},{default:s(({row:a})=>[r(" NT$ "+o(g(a.totalAmount)),1)]),_:1}),t(n,{label:"操作",width:"180"},{default:s(({row:a})=>[t(P,{type:"primary",link:"",onClick:d=>E(a)},{default:s(()=>e[6]||(e[6]=[r(" 詳情 ")])),_:2},1032,["onClick"]),a.status==="pending"?(_(),k(P,{key:0,type:"success",link:"",onClick:d=>G(a)},{default:s(()=>e[7]||(e[7]=[r(" 確認 ")])),_:2},1032,["onClick"])):V("",!0),a.status==="confirmed"?(_(),k(P,{key:1,type:"warning",link:"",onClick:d=>H(a)},{default:s(()=>e[8]||(e[8]=[r(" 到貨 ")])),_:2},1032,["onClick"])):V("",!0)]),_:1})]),_:1},8,["data"]),i("div",ae,[t(R,{"current-page":N.value,"onUpdate:currentPage":e[3]||(e[3]=a=>N.value=a),"page-size":C.value,"onUpdate:pageSize":e[4]||(e[4]=a=>C.value=a),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])])]),_:1})]),t(q,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=a=>D.value=a),title:"進貨單詳情",width:"800px"},{default:s(()=>{var a;return[u.value?(_(),h(A,{key:0},[t(j,{column:2,border:""},{default:s(()=>[t(v,{label:"進貨單號"},{default:s(()=>[r(o(u.value.id),1)]),_:1}),t(v,{label:"建立時間"},{default:s(()=>[r(o(w(u.value.createdAt)),1)]),_:1}),t(v,{label:"供應商"},{default:s(()=>[r(o(u.value.supplier.name),1)]),_:1}),t(v,{label:"狀態"},{default:s(()=>[t(x,{type:L(u.value.status)},{default:s(()=>[r(o(z(u.value.status)),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"預計到貨"},{default:s(()=>[r(o(w(u.value.expectedDeliveryDate)),1)]),_:1}),t(v,{label:"付款條件"},{default:s(()=>[r(o(u.value.supplier.paymentTerm),1)]),_:1})]),_:1}),t($,{data:u.value.items,style:{width:"100%","margin-top":"16px"}},{default:s(()=>[t(n,{prop:"name",label:"商品名稱"}),t(n,{prop:"purchaseQty",label:"數量",width:"120"}),t(n,{prop:"price",label:"單價",width:"120"},{default:s(({row:d})=>[r(" NT$ "+o(g(d.price)),1)]),_:1}),t(n,{label:"小計",width:"120"},{default:s(({row:d})=>[r(" NT$ "+o(g(d.price*d.purchaseQty)),1)]),_:1})]),_:1},8,["data"]),i("div",le,[i("div",se,[e[9]||(e[9]=i("span",null,"商品總數：",-1)),i("span",ne,o(I(u.value))+" 瓶",1)]),i("div",re,[e[10]||(e[10]=i("span",null,"採購總額：",-1)),i("span",oe,"NT$ "+o(g(u.value.totalAmount)),1)])]),(a=u.value.relatedOrders)!=null&&a.length?(_(),h("div",de,[e[11]||(e[11]=i("h4",null,"關聯訂單",-1)),t($,{data:u.value.relatedOrders,style:{width:"100%"}},{default:s(()=>[t(n,{prop:"id",label:"訂單編號",width:"120"}),t(n,{prop:"customer.name",label:"客戶名稱",width:"120"}),t(n,{prop:"createdAt",label:"建立時間",width:"160"},{default:s(({row:d})=>[r(o(w(d.createdAt)),1)]),_:1}),t(n,{prop:"total",label:"訂單金額",width:"120"},{default:s(({row:d})=>[r(" NT$ "+o(g(d.total)),1)]),_:1})]),_:1},8,["data"])])):V("",!0)],64)):V("",!0)]}),_:1},8,["modelValue"])])}}},ce=J(ue,[["__scopeId","data-v-dd14e89e"]]);export{ce as default};
