import{_ as $,G as C,r as N,v as O,o as W,a as d,b as y,d as B,h as i,e as t,w as a,g as M,B as A,m as r,i as u,E as w}from"./index-ac2423d8.js";import{u as P}from"./warehouse-82359bb4.js";const R={class:"warehouse-in"},U={class:"main-content"},z={class:"card-header"},E={class:"actions"},T={__name:"WarehouseInView",setup(F){const _=C(),S=P(),l=N(null),v=O(()=>_.getPendingWarehouseInOrders),V=o=>{l.value={...o,items:o.items.map(e=>({...e,receivedQty:e.purchaseQty,note:""}))}},x=()=>{l.value=null},D=()=>{if(!l.value)return;const o={receivedAt:new Date().toISOString(),items:l.value.items.map(e=>({id:e.id,receivedQty:e.receivedQty,note:e.note}))};_.confirmWarehouseIn(l.value.id,o)?(S.createInboundRecord(l.value,o),w.success("入倉完成"),l.value=null):w.error("入倉失敗")},h=o=>{const e=new Date(o);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},f=o=>o.toLocaleString();return W(()=>{v.value.length===0&&_.initializeMockPurchaseOrders()}),(o,e)=>{const s=d("el-table-column"),m=d("el-button"),b=d("el-table"),g=d("el-card"),c=d("el-descriptions-item"),k=d("el-descriptions"),I=d("el-input-number"),Q=d("el-input");return y(),B("div",R,[e[5]||(e[5]=i("div",{class:"page-header"},[i("h2",null,"入倉作業")],-1)),i("div",U,[t(g,{class:"purchase-orders"},{header:a(()=>e[0]||(e[0]=[i("div",{class:"card-header"},[i("h3",null,"待入倉進貨單")],-1)])),default:a(()=>[t(b,{data:v.value,style:{width:"100%"}},{default:a(()=>[t(s,{type:"selection",width:"55"}),t(s,{prop:"id",label:"進貨單號",width:"120"}),t(s,{prop:"supplier.name",label:"供應商",width:"120"}),t(s,{prop:"expectedDeliveryDate",label:"預計到貨",width:"160"},{default:a(({row:n})=>[r(u(h(n.expectedDeliveryDate)),1)]),_:1}),t(s,{prop:"totalAmount",label:"總金額",width:"120"},{default:a(({row:n})=>[r(" NT$ "+u(f(n.totalAmount)),1)]),_:1}),t(s,{label:"操作",width:"120"},{default:a(({row:n})=>[t(m,{type:"primary",link:"",onClick:p=>V(n)},{default:a(()=>e[1]||(e[1]=[r(" 收貨 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l.value?(y(),M(g,{key:0,class:"receiving-form"},{header:a(()=>[i("div",z,[e[4]||(e[4]=i("h3",null,"收貨確認",-1)),i("div",E,[t(m,{onClick:x},{default:a(()=>e[2]||(e[2]=[r("取消")])),_:1}),t(m,{type:"primary",onClick:D},{default:a(()=>e[3]||(e[3]=[r("確認入倉")])),_:1})])])]),default:a(()=>[t(k,{column:2,border:""},{default:a(()=>[t(c,{label:"進貨單號"},{default:a(()=>[r(u(l.value.id),1)]),_:1}),t(c,{label:"供應商"},{default:a(()=>[r(u(l.value.supplier.name),1)]),_:1}),t(c,{label:"預計到貨"},{default:a(()=>[r(u(h(l.value.expectedDeliveryDate)),1)]),_:1}),t(c,{label:"總金額"},{default:a(()=>[r(" NT$ "+u(f(l.value.totalAmount)),1)]),_:1})]),_:1}),t(b,{data:l.value.items,style:{width:"100%","margin-top":"16px"}},{default:a(()=>[t(s,{prop:"name",label:"商品名稱"}),t(s,{prop:"purchaseQty",label:"採購數量",width:"120"}),t(s,{label:"實收數量",width:"150"},{default:a(({row:n})=>[t(I,{modelValue:n.receivedQty,"onUpdate:modelValue":p=>n.receivedQty=p,min:0,max:n.purchaseQty,size:"small"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),t(s,{label:"備註",width:"200"},{default:a(({row:n})=>[t(Q,{modelValue:n.note,"onUpdate:modelValue":p=>n.note=p,placeholder:"輸入備註",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})):A("",!0)])])}}},L=$(T,[["__scopeId","data-v-669a6bda"]]);export{L as default};
