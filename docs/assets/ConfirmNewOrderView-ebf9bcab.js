import{_ as X,s as Z,v as T,r as m,a as u,b as c,d as p,h as t,F as U,f as B,e as s,w as o,g as M,i as a,m as d,n as q,B as A,E as F}from"./index-e1c6c1fc.js";const ee={class:"confirm-new-order"},te={class:"main-content"},le={class:"order-list"},oe={class:"order-card-header"},se={class:"order-id"},ne={class:"order-info"},ae={class:"customer-info"},de={class:"order-amount"},ie={class:"order-time"},re={key:0,class:"order-detail"},ue={class:"detail-header"},ce={class:"actions"},me={class:"customer-section"},pe={class:"info-grid"},ve={class:"info-item"},fe={class:"info-item"},_e={class:"info-item"},ge={class:"products-section"},ye={class:"order-total"},be={class:"amount"},Ve={key:0,class:"note-section"},we={class:"communication-header"},ke={class:"communication-list"},Ce={class:"comm-header"},Ne={class:"comm-type"},xe={class:"comm-time"},Oe={class:"comm-content"},he={key:1,class:"no-selection"},De={class:"dialog-footer"},Se={class:"dialog-footer"},Fe={class:"dialog-footer"},$e={__name:"ConfirmNewOrderView",setup(je){const y=Z(),R=T(()=>y.getPendingOrders),n=m(null),E=T(()=>n.value?y.getCommunications(n.value.id):[]),b=m(!1),V=m(!1),w=m(!1),v=m({note:""}),f=m({reason:""}),_=m({content:""}),z={reason:[{required:!0,message:"請輸入拒絕原因",trigger:"blur"}]},I={content:[{required:!0,message:"請輸入備註內容",trigger:"blur"}]},L=i=>{n.value={...i}},$=i=>{if(!i)return"";const e=new Date(i);if(isNaN(e.getTime()))return"Invalid Date";const N=e.getFullYear(),k=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),x=String(e.getMinutes()).padStart(2,"0");return N+"-"+k+"-"+r+" "+g+":"+x},C=i=>i.toLocaleString(),H=i=>({note:"客服備註",system:"系統記錄"})[i]||i,P=()=>{n.value&&(v.value.note="",b.value=!0)},Y=()=>{n.value&&(f.value.reason="",V.value=!0)},G=()=>{n.value&&(_.value.content="",w.value=!0)},J=async()=>{if(!n.value)return;y.confirmOrder(n.value.id,v.value.note)&&(b.value=!1,n.value=null,F.success("訂單已確認"))},K=async()=>{if(!n.value)return;y.rejectOrder(n.value.id,f.value.reason)&&(V.value=!1,n.value=null,F.success("訂單已拒絕"))},Q=async()=>{if(!n.value)return;y.addCommunication(n.value.id,_.value.content,"note")&&(w.value=!1,F.success("備註添加成功"))};return(i,e)=>{const N=u("el-tag"),k=u("el-card"),r=u("el-button"),g=u("el-table-column"),x=u("el-table"),W=u("el-empty"),O=u("el-input"),h=u("el-form-item"),D=u("el-form"),S=u("el-dialog");return c(),p("div",ee,[e[29]||(e[29]=t("div",{class:"page-header"},[t("h2",null,"確認新訂單")],-1)),t("div",te,[t("div",le,[(c(!0),p(U,null,B(R.value,l=>{var j;return c(),M(k,{key:l.id,class:q({active:((j=n.value)==null?void 0:j.id)===l.id}),onClick:Te=>L(l)},{default:o(()=>[t("div",oe,[t("span",se,a(l.id),1),s(N,{type:"warning"},{default:o(()=>e[9]||(e[9]=[d("待處理")])),_:1})]),t("div",ne,[t("div",ae,[t("p",null,a(l.customer.name),1),t("p",null,a(l.customer.phone),1)]),t("div",de," NT$ "+a(C(l.total)),1)]),t("div",ie,a($(l.createdAt)),1)]),_:2},1032,["class","onClick"])}),128))]),n.value?(c(),p("div",re,[s(k,{class:"detail-section"},{header:o(()=>[t("div",ue,[e[12]||(e[12]=t("h3",null,"訂單詳情",-1)),t("div",ce,[s(r,{type:"success",onClick:P},{default:o(()=>e[10]||(e[10]=[d(" 確認訂單 ")])),_:1}),s(r,{type:"danger",onClick:Y},{default:o(()=>e[11]||(e[11]=[d(" 拒絕訂單 ")])),_:1})])])]),default:o(()=>[t("div",me,[e[16]||(e[16]=t("h4",null,"客戶資訊",-1)),t("div",pe,[t("div",ve,[e[13]||(e[13]=t("label",null,"姓名：",-1)),t("span",null,a(n.value.customer.name),1)]),t("div",fe,[e[14]||(e[14]=t("label",null,"電話：",-1)),t("span",null,a(n.value.customer.phone),1)]),t("div",_e,[e[15]||(e[15]=t("label",null,"地址：",-1)),t("span",null,a(n.value.customer.address),1)])])]),t("div",ge,[e[19]||(e[19]=t("h4",null,"商品清單",-1)),s(x,{data:n.value.products,style:{width:"100%"}},{default:o(()=>[s(g,{prop:"name",label:"商品名稱"},{default:o(({row:l})=>[d(a(l.name)+" ",1),l.preorder?(c(),M(N,{key:0,size:"small",type:"warning"},{default:o(()=>e[17]||(e[17]=[d("預購")])),_:1})):A("",!0)]),_:1}),s(g,{prop:"price",label:"單價",width:"120"},{default:o(({row:l})=>[d(" NT$ "+a(C(l.price)),1)]),_:1}),s(g,{prop:"quantity",label:"數量",width:"100"}),s(g,{label:"小計",width:"120"},{default:o(({row:l})=>[d(" NT$ "+a(C(l.price*l.quantity)),1)]),_:1})]),_:1},8,["data"]),t("div",ye,[e[18]||(e[18]=t("span",null,"訂單總計：",-1)),t("span",be,"NT$ "+a(C(n.value.total)),1)])]),n.value.note?(c(),p("div",Ve,[e[20]||(e[20]=t("h4",null,"訂單備註",-1)),t("p",null,a(n.value.note),1)])):A("",!0)]),_:1}),s(k,{class:"communication-section"},{header:o(()=>[t("div",we,[e[22]||(e[22]=t("h3",null,"溝通記錄",-1)),s(r,{type:"primary",onClick:G},{default:o(()=>e[21]||(e[21]=[d(" 添加備註 ")])),_:1})])]),default:o(()=>[t("div",ke,[(c(!0),p(U,null,B(E.value,l=>(c(),p("div",{key:l.id,class:q(["communication-item",l.type])},[t("div",Ce,[t("span",Ne,a(H(l.type)),1),t("span",xe,a($(l.createdAt)),1)]),t("div",Oe,a(l.content),1)],2))),128))])]),_:1})])):(c(),p("div",he,[s(W,{description:"請選擇一個訂單"})]))]),s(S,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),title:"確認訂單",width:"500px"},{footer:o(()=>[t("span",De,[s(r,{onClick:e[1]||(e[1]=l=>b.value=!1)},{default:o(()=>e[23]||(e[23]=[d("取消")])),_:1}),s(r,{type:"primary",onClick:J},{default:o(()=>e[24]||(e[24]=[d(" 確認 ")])),_:1})])]),default:o(()=>[s(D,{ref_key:"confirmForm",ref:v,model:v.value,"label-width":"100px"},{default:o(()=>[s(h,{label:"確認備註"},{default:o(()=>[s(O,{modelValue:v.value.note,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value.note=l),type:"textarea",rows:"3",placeholder:"請輸入確認備註（選填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(S,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),title:"拒絕訂單",width:"500px"},{footer:o(()=>[t("span",Se,[s(r,{onClick:e[4]||(e[4]=l=>V.value=!1)},{default:o(()=>e[25]||(e[25]=[d("取消")])),_:1}),s(r,{type:"danger",onClick:K},{default:o(()=>e[26]||(e[26]=[d(" 拒絕 ")])),_:1})])]),default:o(()=>[s(D,{ref_key:"rejectForm",ref:f,model:f.value,rules:z,"label-width":"100px"},{default:o(()=>[s(h,{label:"拒絕原因",prop:"reason"},{default:o(()=>[s(O,{modelValue:f.value.reason,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value.reason=l),type:"textarea",rows:"3",placeholder:"請輸入拒絕原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(S,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=l=>w.value=l),title:"添加備註",width:"500px"},{footer:o(()=>[t("span",Fe,[s(r,{onClick:e[7]||(e[7]=l=>w.value=!1)},{default:o(()=>e[27]||(e[27]=[d("取消")])),_:1}),s(r,{type:"primary",onClick:Q},{default:o(()=>e[28]||(e[28]=[d(" 添加 ")])),_:1})])]),default:o(()=>[s(D,{ref_key:"noteForm",ref:_,model:_.value,rules:I,"label-width":"100px"},{default:o(()=>[s(h,{label:"備註內容",prop:"content"},{default:o(()=>[s(O,{modelValue:_.value.content,"onUpdate:modelValue":e[6]||(e[6]=l=>_.value.content=l),type:"textarea",rows:"3",placeholder:"請輸入備註內容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Be=X($e,[["__scopeId","data-v-384b43e2"]]);export{Be as default};
