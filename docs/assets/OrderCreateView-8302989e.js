import{_ as X,p as Y,q as Z,s as ee,v as I,r as C,z as te,a as s,b as _,d as y,h as n,e as o,w as t,E as B,m as i,i as f,F as D,f as $,g as N,u as oe,A as re,B as ae}from"./index-e1c6c1fc.js";const le={class:"order-create"},se={class:"page-header"},ne={class:"card-header"},de={class:"option-price"},ue={class:"order-total"},ce={class:"amount"},pe={__name:"OrderCreateView",setup(ie){const R=Y(),E=Z(),A=ee(),m=I(()=>E.userInfo.customerInfo),v=C([{id:"P001",name:"法國波爾多紅酒 2018",price:2580,stock:0,preorder:!0},{id:"P002",name:"意大利基安蒂紅酒 2019",price:1980,stock:0,preorder:!0},{id:"P003",name:"西班牙里奧哈紅酒 2017",price:2180,stock:0,preorder:!0},{id:"P004",name:"法國勃艮第白酒 2020",price:2380,stock:5,preorder:!1},{id:"P005",name:"意大利白葡萄酒 2021",price:1680,stock:0,preorder:!0},{id:"P006",name:"德國雷司令白酒 2020",price:1880,stock:0,preorder:!0},{id:"P007",name:"獺祭 純米大吟釀 45",price:1580,stock:3,preorder:!1},{id:"P008",name:"久保田 千寿",price:1280,stock:0,preorder:!0},{id:"P009",name:"出羽桜 純米大吟釀",price:1480,stock:0,preorder:!0},{id:"P010",name:"八海山 特別本醸造",price:980,stock:0,preorder:!0}]),V=C(null),k=C(!1),r=te({customer:I(()=>({name:m.value.name,phone:m.value.phone,address:m.value.address})),products:[{id:"",quantity:1,price:0,subtotal:0,preorder:!1}],payment:{method:"online"},note:"",total:0}),h={product:[{required:!0,message:"請選擇商品",trigger:"change"}],quantity:[{required:!0,message:"請輸入數量",trigger:"change"},{type:"number",min:1,message:"數量必須大於0",trigger:"change"}],"payment.method":[{required:!0,message:"請選擇付款方式",trigger:"change"}]},F=(a,e)=>{const d=v.value.find(p=>p.id===a);d&&(r.products[e].price=d.price,r.products[e].preorder=d.preorder,q(e))},L=(a,e)=>{q(e)},q=a=>{const e=r.products[a];e.subtotal=e.price*e.quantity,S()},S=()=>{r.total=r.products.reduce((a,e)=>a+(e.subtotal||0),0)},T=()=>{const a={id:"",quantity:1,price:0,subtotal:0,preorder:!1};r.products=[...r.products,a]},z=a=>{r.products=r.products.filter((e,d)=>d!==a),S()},M=async()=>{if(V.value)try{k.value=!0,await V.value.validate();const a={id:`ORD-${Date.now()}`,createdAt:new Date().toISOString(),customer:r.customer,products:r.products.map(d=>{const p=v.value.find(w=>w.id===d.id);return{...d,name:p.name,preorder:p.preorder,stockStatus:"pending"}}),payment:r.payment,note:r.note,total:r.total,status:"pending"},e=A.createOrder(a);B.success("訂單提交成功"),R.push({name:"order-list"})}catch(a){console.error("表單驗證失敗：",a),B.error("請檢查表單填寫是否正確")}finally{k.value=!1}},Q=a=>a.stock===0&&a.preorder?`${a.name} (預購)`:a.name;return(a,e)=>{const d=s("el-button"),p=s("el-descriptions-item"),w=s("el-descriptions"),P=s("el-card"),j=s("el-option"),x=s("el-select"),b=s("el-form-item"),g=s("el-col"),G=s("el-input-number"),U=s("el-input"),H=s("el-icon"),J=s("el-row"),O=s("el-radio"),K=s("el-radio-group"),W=s("el-form");return _(),y("div",le,[n("div",se,[e[3]||(e[3]=n("h2",null,"建立訂單",-1)),o(d,{type:"primary",onClick:M,loading:k.value},{default:t(()=>e[2]||(e[2]=[i(" 提交訂單 ")])),_:1},8,["loading"])]),o(W,{ref_key:"formRef",ref:V,model:r,rules:h,"label-width":"100px",class:"order-form"},{default:t(()=>[o(P,{class:"mb-4"},{header:t(()=>e[4]||(e[4]=[n("div",{class:"card-header"},[n("span",null,"客戶資訊")],-1)])),default:t(()=>[o(w,{column:2,border:""},{default:t(()=>[o(p,{label:"姓名"},{default:t(()=>[i(f(m.value.name),1)]),_:1}),o(p,{label:"電話"},{default:t(()=>[i(f(m.value.phone),1)]),_:1}),o(p,{label:"地址",span:2},{default:t(()=>[i(f(m.value.address),1)]),_:1})]),_:1})]),_:1}),o(P,{class:"mb-4"},{header:t(()=>[n("div",ne,[e[6]||(e[6]=n("span",null,"商品選擇",-1)),o(d,{type:"primary",link:"",onClick:T},{default:t(()=>e[5]||(e[5]=[i(" 新增商品 ")])),_:1})])]),default:t(()=>[(_(!0),y(D,null,$(r.products,(u,c)=>(_(),y("div",{key:`product-${c}-${u.id||"new"}`,class:"product-item"},[o(J,{gutter:20},{default:t(()=>[o(g,{span:8},{default:t(()=>[o(b,{label:c===0?"商品":"",prop:"products."+c+".id",rules:h.product},{default:t(()=>[o(x,{modelValue:u.id,"onUpdate:modelValue":l=>u.id=l,placeholder:"請選擇商品",onChange:l=>F(l,c),class:"w-100"},{default:t(()=>[(_(!0),y(D,null,$(v.value,l=>(_(),N(j,{key:l.id,label:Q(l),value:l.id},{default:t(()=>[n("span",null,f(l.name),1),n("span",de,"¥"+f(l.price),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","prop","rules"])]),_:2},1024),o(g,{span:6},{default:t(()=>[o(b,{label:c===0?"數量":"",prop:"products."+c+".quantity",rules:h.quantity},{default:t(()=>[o(G,{modelValue:u.quantity,"onUpdate:modelValue":l=>u.quantity=l,min:1,max:99,onChange:l=>L(l,c),class:"w-100"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","prop","rules"])]),_:2},1024),o(g,{span:6},{default:t(()=>[o(b,{label:c===0?"小計":""},{default:t(()=>[o(U,{modelValue:u.subtotal,"onUpdate:modelValue":l=>u.subtotal=l,readonly:"",class:"w-100"},{prefix:t(()=>e[7]||(e[7]=[i("¥")])),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),o(g,{span:4,class:"text-right"},{default:t(()=>[c!==0?(_(),N(d,{key:0,type:"danger",circle:"",onClick:l=>z(c),class:"mt-4"},{default:t(()=>[o(H,null,{default:t(()=>[o(oe(re))]),_:1})]),_:2},1032,["onClick"])):ae("",!0)]),_:2},1024)]),_:2},1024)]))),128)),n("div",ue,[e[8]||(e[8]=n("span",{class:"label"},"訂單總計：",-1)),n("span",ce,"¥"+f(r.total),1)])]),_:1}),o(P,null,{header:t(()=>e[9]||(e[9]=[n("div",{class:"card-header"},[n("span",null,"付款資訊")],-1)])),default:t(()=>[o(b,{label:"付款方式",prop:"payment.method"},{default:t(()=>[o(K,{modelValue:r.payment.method,"onUpdate:modelValue":e[0]||(e[0]=u=>r.payment.method=u)},{default:t(()=>[o(O,{label:"online"},{default:t(()=>e[10]||(e[10]=[i("線上付款")])),_:1}),o(O,{label:"cod"},{default:t(()=>e[11]||(e[11]=[i("貨到付款")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"備註"},{default:t(()=>[o(U,{modelValue:r.note,"onUpdate:modelValue":e[1]||(e[1]=u=>r.note=u),type:"textarea",rows:"3",placeholder:"請輸入備註（選填）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])])}}},_e=X(pe,[["__scopeId","data-v-00c88b1b"]]);export{_e as default};
